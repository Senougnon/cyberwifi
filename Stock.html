
<!DOCTYPE html>
<html lang="fr">
<head>
    <!-- (Head section - No changes except for adding Font Awesome) -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de bord des ventes WiFi Zone</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* (CSS - No changes needed here except as noted below) */
         :root {
            --primary-color: #00ffff;
            --secondary-color: #ff00ff;
            --background-color: #0a0a1a;
            --text-color: #00ffff;
            --input-bg: rgba(255, 255, 255, 0.1);
            --box-bg: rgba(20, 20, 40, 0.8);
            --button-text-color: #0a0a1a;
            --table-border-color: rgba(0, 255, 255, 0.3);
            --table-header-bg: rgba(0, 255, 255, 0.2);
        }

        :root.light-theme {
            --primary-color: #008080;
            --secondary-color: #800080;
            --background-color: #f0f0f0;
            --text-color: #333333;
            --input-bg: rgba(0, 0, 0, 0.1);
            --box-bg: rgba(255, 255, 255, 0.8);
            --button-text-color: #ffffff;
            --table-border-color: rgba(0, 128, 128, 0.3);
            --table-header-bg: rgba(0, 128, 128, 0.2);
        }

        body {
            font-family: 'Orbitron', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: var(--background-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--box-bg);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
        }

        h1, h2, h3 {
            color: var(--primary-color);
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        form {
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        input, select, button {
            padding: 10px;
            border: none;
            background-color: var(--input-bg);
            color: var(--text-color);
            border-radius: 5px;
        }

        button {
            background-color: var(--primary-color);
            color: var(--button-text-color); /* Utilisation de la nouvelle variable */
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            background-color: var(--secondary-color);
        }

        /* Le reste du CSS reste inchangé */

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-bottom: 20px;
            border: 1px solid var(--table-border-color);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.1);
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--table-border-color);
        }

        th {
            background-color: var(--table-header-bg);
            color: var(--text-color);
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        th:hover {
            background-color: var(--primary-color);
            color: var(--button-text-color);
        }

        tr:last-child td {
            border-bottom: none;
        }

        tbody tr:hover {
            background-color: var(--input-bg);
        }

        /* Styles pour les tables de stock */
        .stock-table {
            margin-bottom: 30px;
        }

        .stock-table h3 {
            margin-bottom: 10px;
        }

        .table-wrapper {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.15);
        }

        #salesChart {
            margin-top: 20px;
            background-color: var(--box-bg);
            border-radius: 10px;
            padding: 20px;
        }

        /* Styles pour la section de connexion/inscription */
        #authSection {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        #authSection input {
            margin-bottom: 10px;
            width: 200px;
        }



        #dashboardHeader {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        #userInfo {
            font-size: 1.2em;
            color: var(--text-color);
			display: flex; /* Make userInfo a flex container */
            align-items: center; /* Vertically center items */
            gap: 10px; /* Add some space between items */
        }

        #searchInputs {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        #searchInputs input {
            width: calc(100% / 8 - 10px);
        }

        .button-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .toggle-button {
            width: 48%;
            padding: 10px;
            background-color: var(--primary-color);
            color: var(--background-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-button:hover {
            background-color: var(--secondary-color);
        }

        #analysisSection, #salesDetailsSection {
            display: none;
        }

        .period-analysis {
            margin-top: 20px;
            background-color: var(--input-bg);
            padding: 15px;
            border-radius: 10px;
        }

        .period-analysis h3 {
            color: var(--primary-color);
            margin-top: 0;
        }

        #theme-toggle {
            position: fixed;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 24px;
            z-index: 1001;
            padding: 5px;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }

        #theme-toggle:hover {
            background-color: var(--input-bg);
        }

        .date-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .date-filter input {
            flex: 1;
        }

        .stock-tables {
            display: flex;
            flex-direction: column;
        }

        .stock-table {
            width: 100%;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .stock-table table {
            width: 100%;
            min-width: 300px;
        }

        @media (min-width: 768px) {
            .stock-tables {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: space-between;
            }

            .stock-table {
                width: 48%;
            }
        }
        /* Styles pour l'icône de suppression */
        .delete-icon {
            display: none;
            position: absolute;
            top: 5px;
            left: 5px;
            cursor: pointer;
            color: var(--secondary-color);
            font-size: 18px;
            transition: color 0.3s ease;
        }

        .delete-icon:hover {
            color: var(--primary-color);
        }

        /* Ajoutez cette règle pour rendre les cellules du tableau relatives */
        #salesTable tbody td {
            position: relative;
        }

        /* Afficher l'icône de suppression au survol de la ligne */
        #salesTable tbody tr:hover .delete-icon {
            display: block;
        }

        /* Style pour la boîte de dialogue de confirmation */
        .confirm-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--box-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            z-index: 1000;
        }

        .confirm-dialog p {
            margin-bottom: 20px;
        }

        .confirm-dialog button {
            margin-right: 10px;
        }

        /* Styles pour l'icône de suppression */
        .delete-icon {
            display: none;
            position: absolute;
            top: 5px;
            left: 5px;
            cursor: pointer;
            color: var(--secondary-color);
            font-size: 18px;
            transition: color 0.3s ease;
        }

        .delete-icon:hover {
            color: var(--primary-color);
        }

        /* Ajoutez cette règle pour rendre les cellules du tableau relatives */
        #salesTable tbody td {
            position: relative;
        }

        /* Afficher l'icône de suppression au survol de la ligne */
        #salesTable tbody tr:hover .delete-icon {
            display: block;
        }

        /* Style pour la boîte de dialogue de confirmation */
        .confirm-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--box-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            z-index: 1000;
        }

        .confirm-dialog p {
            margin-bottom: 20px;
        }

        .confirm-dialog button {
            margin-right: 10px;
        }
        .export-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: var(--button-text-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            z-index: 1000;
            font-family: 'Orbitron', sans-serif;
        }

        .export-button:hover {
            background-color: var(--secondary-color);
        }

        /* Assurer la visibilité du bouton sur les petits écrans */
        @media (max-width: 768px) {
            .export-button {
                bottom: 10px;
                right: 10px;
                padding: 8px 16px;
                font-size: 0.9em;
            }
        }

        #stockConfigSection {
            margin-bottom: 30px;
        }

        #stockConfigForm {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        #stockConfigForm .config-group {
            flex: 1;
            min-width: 200px;
        }

        #stockConfigForm label {
            display: block;
            margin-bottom: 5px;
        }

        #stockConfigForm select {
            width: 100%;
            padding: 5px;
            border: 1px solid var(--table-border-color);
            border-radius: 5px;
            background-color: var(--input-bg);
            color: var(--text-color);
        }

        .subscription-required {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .subscription-required-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            max-width: 400px;
            width: 90%;
        }

        .subscription-required-content h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .subscription-required-content p {
            color: #666;
            margin-bottom: 30px;
        }

        .subscription-required-content button {
            background-color: var(--primary-color);
            color: var(--button-text-color);
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            margin: 0 10px;
        }

        .subscription-required-content button:hover {
            background-color: var(--secondary-color);
        }
        .logout-button {
            position: relative; /* Changed from fixed to relative */
            top: auto; /* Reset top */
            right: auto; /* Reset right */
            margin-left: 10px; /* Add some space from the title */
            z-index: auto;
            background-color: #e74c3c;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .logout-button:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .logout-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .logout-button i {
            font-size: 16px;
        }

        @media (max-width: 768px) {
            .logout-button {
                top: 10px;
                right: 10px;
                padding: 8px 16px;
                font-size: 12px;
            }
        }

        .auth-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
		/* Add User Modal Styles */
        #addUserModal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--box-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            z-index: 1002;
        }

        #addUserModal input {
            margin-bottom: 10px;
            width: 100%;
        }
          /* User Select Dropdown Styles */
        #userSelect {
            padding: 5px;
            border-radius: 5px;
            background-color: var(--input-bg);
            color: var(--text-color);
            border: 1px solid var(--table-border-color);
        }
    </style>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <button id="theme-toggle" aria-label="Toggle theme">🌙</button>

    <!-- Section d'authentification -->
    <div id="authSection" class="container" style="display: block;">
        <h1>Connexion / Inscription</h1>
        <form id="loginForm">
            <input type="text" id="username" placeholder="Nom d'utilisateur" required>
            <input type="password" id="password" placeholder="Mot de passe" required>
            <div class="auth-buttons">
                <button type="submit">Se connecter</button>
                <button type="button" id="signupButton">S'inscrire</button>
            </div>
        </form>
        <form id="signupForm" style="display: none;">
            <input type="text" id="signupUsername" placeholder="Nom d'utilisateur" required>
            <input type="password" id="signupPassword" placeholder="Mot de passe" required>
            <div class="auth-buttons">
                <button type="submit">S'inscrire</button>
                <button type="button" id="loginFromSignup">Se connecter</button>
            </div>
        </form>
    </div>

    <div id="dashboardContainer" class="container" style="display: none;">
        <div id="dashboardHeader">
            <h1>GESTION DE STOCK</h1>
             <div id="userInfo">
                <span></span>  <!-- User name will go here -->
                <i id="addUserIcon" class="fas fa-user-plus" style="cursor: pointer;"></i> <!-- Add User Icon -->
                <select id="userSelect"></select>     <!-- User Select Dropdown -->
            </div>
            <button onclick="logout()" class="logout-button">
                <i class="fas fa-sign-out-alt"></i> Déconnexion
            </button>
        </div>

		<!-- Add User Modal -->
        <div id="addUserModal">
            <h2>Ajouter un utilisateur</h2>
            <form id="addUserForm">
                <input type="text" id="newUserName" placeholder="Nom d'utilisateur" required>
                <button type="submit">Ajouter</button>
                <button type="button" onclick="document.getElementById('addUserModal').style.display='none'">Annuler</button>
            </form>
        </div>


        <h2>Enregistrer une nouvelle opération</h2>
        <form id="salesForm">
            <input type="datetime-local" id="dateTime" required>
            <select id="product" required>
                <option value="">Sélectionner un produit</option>
                <!-- Les options seront ajoutées ici par script.js -->
            </select>
            <input type="number" id="SI" placeholder="Stock Initial" required>
            <input type="number" id="APP" placeholder="Approvisionnement" required>
            <input type="number" id="V" placeholder="Ventes" required>
            <input type="number" id="SF" placeholder="Stock Final" readonly>
            <input type="number" id="PV" placeholder="Prix de Vente" readonly>
            <button type="submit">Ajouter</button>
        </form>

        <h2>Détails des stocks</h2>
        <div class="date-filter">
            <input type="datetime-local" id="stockStartDate">
            <input type="datetime-local" id="stockEndDate">
            <button id="filterStockDates">Filtrer</button>
        </div>
        <div class="stock-table">
            <h3>Stock Global</h3>
            <div class="table-wrapper">
                <table id="stockTableGlobal">
                    <thead>
                        <tr>
                            <th data-sort="product">Produit</th>
                            <th data-sort="SF">Stock Final</th>
                            <th data-sort="dateTime">Date et Heure</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div class="button-container">
            <button id="toggleSalesButton" class="toggle-button">Détail des ventes</button>
            <button id="toggleAnalysisButton" class="toggle-button">Analyse des ventes</button>
        </div>

        <div id="salesDetailsSection">
            <h2>Détails des ventes</h2>
            <div class="date-filter">
                <input type="datetime-local" id="salesStartDate">
                <input type="datetime-local" id="salesEndDate">
                <button id="filterSalesDates">Filtrer</button>
            </div>
            <div id="searchInputs">
                <input type="text" id="searchDateTime" placeholder="Rechercher Date/Heure">
                <input type="text" id="searchProduct" placeholder="Rechercher Produit">
                <input type="text" id="searchSI" placeholder="Rechercher SI">
                <input type="text" id="searchAPP" placeholder="Rechercher APP">
                <input type="text" id="searchV" placeholder="Rechercher V">
                <input type="text" id="searchSF" placeholder="Rechercher SF">
                <input type="text" id="searchPV" placeholder="Rechercher PV">
                <input type="text" id="searchTotal" placeholder="Rechercher Total">
            </div>
            <table id="salesTable">
                <thead>
                    <tr>
                        <th data-sort="dateTime">Date et Heure</th>
                        <th data-sort="product">Produit</th>
                        <th data-sort="SI">SI</th>
                        <th data-sort="APP">APP</th>
                        <th data-sort="V">V</th>
                        <th data-sort="SF">SF</th>
                        <th data-sort="PV (FCFA)</th>
                        <th data-sort="total">Total (FCFA)</th>
                    </tr>
                </thead>
                <tbody></tbody>            </table>
                <button id="exportExcel" class="export-button">Exporter vers Excel</button>
            </div>

            <div id="analysisSection">
                <h2>Analyse des ventes</h2>
                <p id="totalSales"></p>
                <p id="averageSales"></p>
                <canvas id="salesChart"></canvas>

                <div class="period-analysis" id="weekAnalysis">
                    <h3>Analyse de la semaine</h3>
                    <p id="weekTotalSales"></p>
                    <p id="weekAverageSales"></p>
                </div>

                <div class="period-analysis" id="monthAnalysis">
                    <h3>Analyse du mois</h3>
                    <p id="monthTotalSales"></p>
                    <p id="monthAverageSales"></p>
                </div>

                <div class="period-analysis" id="threeMonthAnalysis">
                    <h3>Analyse des 3 derniers mois</h3>
                    <p id="threeMonthTotalSales"></p>
                    <p id="threeMonthAverageSales"></p>
                </div>
            </div>
        </div>
        <div id="subscriptionRequiredModal" class="subscription-required" style="display: none;">
            <div class="subscription-required-content">
                <h2>Abonnement Requis</h2>
                <p>Un abonnement actif est nécessaire pour accéder à cette fonctionnalité.</p>
                <button onclick="window.redirectToSubscription()">S'abonner</button>
                <button onclick="window.hideSubscriptionRequiredModal()">Fermer</button>
            </div>
        </div>

<script type="module">
const _0x15fdc7=_0x5e53;(function(_0x1d1070,_0x42a1b4){const _0xdaf8a9=_0x5e53,_0x157dd1=_0x1d1070();while(!![]){try{const _0x3a2bae=parseInt(_0xdaf8a9(0xfa))/0x1*(-parseInt(_0xdaf8a9(0x159))/0x2)+-parseInt(_0xdaf8a9(0x190))/0x3*(parseInt(_0xdaf8a9(0x158))/0x4)+-parseInt(_0xdaf8a9(0x157))/0x5+parseInt(_0xdaf8a9(0x16f))/0x6+parseInt(_0xdaf8a9(0x1b0))/0x7+parseInt(_0xdaf8a9(0x19d))/0x8*(parseInt(_0xdaf8a9(0x170))/0x9)+-parseInt(_0xdaf8a9(0x180))/0xa*(-parseInt(_0xdaf8a9(0x119))/0xb);if(_0x3a2bae===_0x42a1b4)break;else _0x157dd1['push'](_0x157dd1['shift']());}catch(_0x5bd1d2){_0x157dd1['push'](_0x157dd1['shift']());}}}(_0x1836,0x8c540));import{getActiveDatabase}from'./firebase-config-manager.js';import{initializeApp}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';import{getDatabase,ref,onValue,set,get,update,push,remove,off}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';let db,adminRef,ticketCategories={},salesData=[],stockData=[],salesChart,currentUser,primaryUser,salesDataListener;const authSection=document[_0x15fdc7(0x152)](_0x15fdc7(0x1a8)),dashboardContainer=document['getElementById'](_0x15fdc7(0x107)),salesForm=document[_0x15fdc7(0x152)]('salesForm'),salesTable=document[_0x15fdc7(0x152)](_0x15fdc7(0x161)),totalSalesElement=document[_0x15fdc7(0x152)](_0x15fdc7(0x17c)),averageSalesElement=document[_0x15fdc7(0x152)](_0x15fdc7(0x133)),userInfoElement=document[_0x15fdc7(0x152)]('userInfo')[_0x15fdc7(0x1a0)](_0x15fdc7(0x162)),toggleAnalysisButton=document['getElementById']('toggleAnalysisButton'),toggleSalesButton=document[_0x15fdc7(0x152)]('toggleSalesButton'),analysisSection=document[_0x15fdc7(0x152)](_0x15fdc7(0x17a)),salesDetailsSection=document[_0x15fdc7(0x152)](_0x15fdc7(0x125)),signupButton=document[_0x15fdc7(0x152)](_0x15fdc7(0x11f)),loginFromSignup=document[_0x15fdc7(0x152)](_0x15fdc7(0x171)),productSelect=document[_0x15fdc7(0x152)](_0x15fdc7(0xfc)),stockTableGlobal=document[_0x15fdc7(0x152)](_0x15fdc7(0x19a)),themeToggle=document[_0x15fdc7(0x152)](_0x15fdc7(0x18a)),addUserIcon=document[_0x15fdc7(0x152)](_0x15fdc7(0x153)),addUserModal=document[_0x15fdc7(0x152)](_0x15fdc7(0x12d)),addUserForm=document[_0x15fdc7(0x152)]('addUserForm'),newUserNameInput=document[_0x15fdc7(0x152)]('newUserName'),userSelect=document[_0x15fdc7(0x152)](_0x15fdc7(0x15e));async function initializeDatabase(){const _0x5e4502=_0x15fdc7;db=await getActiveDatabase(),adminRef=ref(db,'admin/subscription'),console[_0x5e4502(0x151)]('Database\x20initialized\x20in\x20Gestion\x20de\x20stock\x20ticket.html');}document[_0x15fdc7(0x18e)](_0x15fdc7(0x144),async()=>{const _0x42eb02=_0x15fdc7;await initializeDatabase(),setupAuthEventListeners(),checkLoginStatus(),setupEventListeners();const _0x937a6e=localStorage[_0x42eb02(0x193)](_0x42eb02(0x14a));_0x937a6e!==null?setTheme(_0x937a6e===_0x42eb02(0x185)):setTheme(![]),document[_0x42eb02(0x152)](_0x42eb02(0x168))[_0x42eb02(0x186)]=new Date()['toISOString']()[_0x42eb02(0x13e)](0x0,0x10);});function addSecondaryUser(_0x59cec9){const _0x368565=_0x15fdc7;if(!primaryUser){console[_0x368565(0x129)](_0x368565(0x1a5));return;}if(!_0x59cec9){alert(_0x368565(0x13a));return;}const _0x39e950=ref(db,_0x368565(0x13d)+primaryUser+'/secondaryUsers'),_0x115a63=push(_0x39e950);set(_0x115a63,{'name':_0x59cec9})[_0x368565(0x11d)](()=>{const _0x1d90c1=_0x368565;console[_0x1d90c1(0x151)](_0x1d90c1(0x145)),addUserModal[_0x1d90c1(0x14d)][_0x1d90c1(0x130)]=_0x1d90c1(0x14b),newUserNameInput[_0x1d90c1(0x186)]='',populateUserSelect();})[_0x368565(0x1a4)](_0x134670=>{const _0x3d245d=_0x368565;console[_0x3d245d(0x129)](_0x3d245d(0x15f),_0x134670);});}async function populateUserSelect(){const _0x1c399a=_0x15fdc7;if(!primaryUser){console[_0x1c399a(0x129)](_0x1c399a(0x19f));return;}userSelect['innerHTML']='';const _0x22f061=document[_0x1c399a(0x1aa)](_0x1c399a(0x174));_0x22f061[_0x1c399a(0x186)]=primaryUser,_0x22f061[_0x1c399a(0x14e)]=userInfoElement['textContent'],userSelect[_0x1c399a(0x16d)](_0x22f061);const _0x15ec43=ref(db,_0x1c399a(0x13d)+primaryUser+_0x1c399a(0x109)),_0x3e2942=await get(_0x15ec43);_0x3e2942[_0x1c399a(0x1b2)]()&&_0x3e2942[_0x1c399a(0x110)](_0x554ae1=>{const _0x1698c2=_0x1c399a,_0x30b010=_0x554ae1[_0x1698c2(0x192)](),_0x45ac75=document['createElement']('option');_0x45ac75['value']=_0x554ae1[_0x1698c2(0x18f)],_0x45ac75[_0x1698c2(0x14e)]=_0x30b010[_0x1698c2(0x12a)],userSelect[_0x1698c2(0x16d)](_0x45ac75);});}function switchUser(_0x141198){const _0x32a155=_0x15fdc7;if(!_0x141198){console[_0x32a155(0x129)]('No\x20user\x20ID\x20provided\x20to\x20switchUser.');return;}currentUser=_0x141198;if(_0x141198===primaryUser)userInfoElement['textContent']=sessionStorage[_0x32a155(0x193)]('primaryUserName');else{const _0x5a4619=ref(db,_0x32a155(0x13d)+primaryUser+_0x32a155(0x150)+_0x141198);get(_0x5a4619)['then'](_0x5afaf0=>{const _0xf5d90=_0x32a155;_0x5afaf0[_0xf5d90(0x1b2)]()&&(userInfoElement[_0xf5d90(0x14e)]=_0x5afaf0['val']()[_0xf5d90(0x12a)]);});}fetchTicketCategories(),updateTable(),updateStockTables(),updateAnalysis(),listenForSalesDataChanges();}async function fetchTicketCategories(){const _0x48b3d2=_0x15fdc7;if(!currentUser){console[_0x48b3d2(0x151)]('User\x20not\x20logged\x20in.\x20Cannot\x20fetch\x20ticket\x20categories.');return;}try{const _0xa4c6c1=ref(db,'users-data/'+primaryUser+_0x48b3d2(0x155)),_0x1e8017=await get(_0xa4c6c1);_0x1e8017[_0x48b3d2(0x1b2)]()?(ticketCategories=_0x1e8017[_0x48b3d2(0x192)](),populateProductSelect()):(console[_0x48b3d2(0x151)](_0x48b3d2(0x116)),ticketCategories={},populateProductSelect());}catch(_0x4e76d1){console['error'](_0x48b3d2(0x108),_0x4e76d1);}}function populateProductSelect(){const _0xfd995=_0x15fdc7;productSelect[_0xfd995(0x123)]=_0xfd995(0x1ac);for(const _0xd009f8 in ticketCategories){const _0x41496b=ticketCategories[_0xd009f8]?.[_0xfd995(0x183)]?.[0x0];if(_0x41496b!==undefined){const _0x12a4d5=document['createElement']('option');_0x12a4d5[_0xfd995(0x186)]=_0xd009f8,_0x12a4d5[_0xfd995(0x14e)]=_0xd009f8+'\x20('+_0x41496b+_0xfd995(0x16a),productSelect[_0xfd995(0x16d)](_0x12a4d5);}}}function checkLoginStatus(){const _0x4c101b=_0x15fdc7;sessionStorage[_0x4c101b(0x193)]('isLoggedIn')===_0x4c101b(0x185)?(currentUser=sessionStorage['getItem'](_0x4c101b(0x143)),primaryUser=sessionStorage['getItem']('currentUserId'),loginSuccess(currentUser,!![])):showAuthSection();}function loginSuccess(_0x1f2280,_0x3b37c5=![]){const _0x231b2=_0x15fdc7;_0x3b37c5&&(primaryUser=_0x1f2280,sessionStorage[_0x231b2(0x113)]('primaryUserName',_0x1f2280),currentUser=_0x1f2280,userInfoElement[_0x231b2(0x14e)]=_0x1f2280,populateUserSelect()),authSection[_0x231b2(0x14d)][_0x231b2(0x130)]=_0x231b2(0x14b),dashboardContainer[_0x231b2(0x14d)][_0x231b2(0x130)]='block',checkSubscriptionStatus()['then'](_0x10deb2=>{const _0x205174=_0x231b2;_0x10deb2?(fetchTicketCategories(),updateTable(),updateStockTables(),updateAnalysis(),listenForSalesDataChanges()):window[_0x205174(0x18d)]();})[_0x231b2(0x1a4)](_0x5ae258=>{const _0x2b3dd4=_0x231b2;console[_0x2b3dd4(0x129)](_0x2b3dd4(0x199),_0x5ae258),alert(_0x2b3dd4(0x16b));});}function listenForSalesDataChanges(){const _0x577371=_0x15fdc7;salesDataListener&&off(ref(db,_0x577371(0x13d)+primaryUser+_0x577371(0x146)+currentUser),'value',salesDataListener),salesDataListener=onValue(ref(db,_0x577371(0x13d)+primaryUser+'/sales/'+currentUser),_0x2f7bcd=>{const _0x4bfdee=_0x577371;salesData=[],_0x2f7bcd[_0x4bfdee(0x1b2)]()&&_0x2f7bcd[_0x4bfdee(0x110)](_0x363764=>{const _0x20892c=_0x4bfdee,_0x113ada=_0x363764[_0x20892c(0x192)]();_0x113ada[_0x20892c(0x18f)]=_0x363764[_0x20892c(0x18f)],_0x113ada[_0x20892c(0x198)]=(_0x113ada['V']*_0x113ada['PV'])[_0x20892c(0x131)](0x2),salesData[_0x20892c(0x10c)](_0x113ada);}),analysisSection[_0x4bfdee(0x14d)]['display']===_0x4bfdee(0x165)&&updateAnalysis(salesData);});}function _0x5e53(_0x54abd0,_0x32c373){const _0x1836a9=_0x1836();return _0x5e53=function(_0x5e5363,_0x41da86){_0x5e5363=_0x5e5363-0xf9;let _0x5192dd=_0x1836a9[_0x5e5363];return _0x5192dd;},_0x5e53(_0x54abd0,_0x32c373);}function updateSF(){const _0x3748b5=_0x15fdc7,_0x259596=parseInt(document[_0x3748b5(0x152)]('SI')['value'])||0x0,_0x12fe09=parseInt(document[_0x3748b5(0x152)](_0x3748b5(0x156))[_0x3748b5(0x186)])||0x0,_0x124515=parseInt(document[_0x3748b5(0x152)]('V')[_0x3748b5(0x186)])||0x0;document[_0x3748b5(0x152)]('SF')[_0x3748b5(0x186)]=_0x259596+_0x12fe09-_0x124515;}function updatePV(){const _0x2d5743=_0x15fdc7,_0x582191=document['getElementById'](_0x2d5743(0xfc))[_0x2d5743(0x186)],_0x2675d5=ticketCategories[_0x582191]?.[_0x2d5743(0x183)]?.[0x0];document['getElementById']('PV')[_0x2d5743(0x186)]=_0x2675d5||0x0;}async function updateTable(){const _0x3f72fb=_0x15fdc7;if(!currentUser){console['error']('User\x20not\x20logged\x20in.\x20Cannot\x20update\x20table.');return;}const _0x18cdb8=salesTable['querySelector']('tbody');_0x18cdb8['innerHTML']='';try{const _0x229dc1=await get(ref(db,_0x3f72fb(0x13d)+primaryUser+'/sales/'+currentUser));salesData=[],_0x229dc1[_0x3f72fb(0x1b2)]()&&_0x229dc1[_0x3f72fb(0x110)](_0x120185=>{const _0x4679e3=_0x3f72fb,_0x1e4462=_0x120185[_0x4679e3(0x192)]();_0x1e4462[_0x4679e3(0x18f)]=_0x120185[_0x4679e3(0x18f)],_0x1e4462[_0x4679e3(0x198)]=(_0x1e4462['V']*_0x1e4462['PV'])['toFixed'](0x2),salesData[_0x4679e3(0x10c)](_0x1e4462);}),renderTable(salesData),setupSearch(),setupSort(salesTable);}catch(_0x400145){console[_0x3f72fb(0x129)](_0x3f72fb(0x124),_0x400145),alert(_0x3f72fb(0x1ab));}}function updateStockTables(_0x2cf75c,_0x989171){const _0x5c66cb=_0x15fdc7;if(!currentUser){console[_0x5c66cb(0x129)](_0x5c66cb(0x176));return;}const _0x53167b=document['getElementById'](_0x5c66cb(0x19a)),_0xe58bcf=_0x53167b['querySelector'](_0x5c66cb(0x15a));_0xe58bcf['innerHTML']='',get(ref(db,_0x5c66cb(0x13d)+primaryUser+'/sales/'+currentUser))[_0x5c66cb(0x11d)](_0x502386=>{const _0x25f7ba=_0x5c66cb,_0x1b2718={};_0x502386[_0x25f7ba(0x1b2)]()&&_0x502386[_0x25f7ba(0x110)](_0x51a019=>{const _0x23820f=_0x25f7ba,_0x37f3cf=_0x51a019['val'](),_0x52243d=new Date(_0x37f3cf[_0x23820f(0x168)]);(!_0x2cf75c||_0x52243d>=_0x2cf75c)&&(!_0x989171||_0x52243d<=_0x989171)&&((!_0x1b2718[_0x37f3cf[_0x23820f(0xfc)]]||_0x52243d>new Date(_0x1b2718[_0x37f3cf[_0x23820f(0xfc)]][_0x23820f(0x168)]))&&(_0x1b2718[_0x37f3cf[_0x23820f(0xfc)]]=_0x37f3cf));}),Object[_0x25f7ba(0x189)](_0x1b2718)[_0x25f7ba(0x110)](_0x3601f2=>{const _0x18db92=_0x25f7ba,_0x50b03b=_0xe58bcf[_0x18db92(0x166)]();_0x50b03b['insertCell'](0x0)[_0x18db92(0x14e)]=_0x3601f2[_0x18db92(0xfc)],_0x50b03b[_0x18db92(0x10d)](0x1)[_0x18db92(0x14e)]=_0x3601f2['SF'],_0x50b03b[_0x18db92(0x10d)](0x2)[_0x18db92(0x14e)]=new Date(_0x3601f2[_0x18db92(0x168)])[_0x18db92(0x140)]();}),setupSort(_0x53167b);});}function exportToExcel(){const _0x1989ab=_0x15fdc7,_0x5ad2c3=XLSX['utils']['book_new'](),_0x56de2c=XLSX[_0x1989ab(0x187)]['table_to_sheet'](document[_0x1989ab(0x152)](_0x1989ab(0x161)));XLSX[_0x1989ab(0x187)][_0x1989ab(0x114)](_0x5ad2c3,_0x56de2c,_0x1989ab(0x184)),XLSX[_0x1989ab(0x122)](_0x5ad2c3,_0x1989ab(0x17f));}async function deleteEntry(_0x56989f){const _0x31a065=_0x15fdc7;if(!currentUser){console['error'](_0x31a065(0x11e));return;}try{const _0x4f7350=await get(ref(db,_0x31a065(0x13d)+primaryUser+_0x31a065(0x146)+currentUser+'/'+_0x56989f)),_0x380773=_0x4f7350[_0x31a065(0x192)]();await remove(ref(db,'users-data/'+primaryUser+'/sales/'+currentUser+'/'+_0x56989f)),console[_0x31a065(0x151)](_0x31a065(0x10e)),await updateStockAfterDeletion(_0x380773),await updateTable(),updateStockTables(),updateAnalysis();}catch(_0x458d4a){console[_0x31a065(0x129)](_0x31a065(0x127),_0x458d4a);}}async function updateStockAfterDeletion(_0x3d8da7){const _0x59e3d1=_0x15fdc7;if(!currentUser){console[_0x59e3d1(0x129)](_0x59e3d1(0x195));return;}try{const _0x1eecfe=await get(ref(db,'users-data/'+primaryUser+_0x59e3d1(0x146)+currentUser)[_0x59e3d1(0x15b)](_0x59e3d1(0x168))[_0x59e3d1(0x138)](_0x3d8da7['dateTime'])[_0x59e3d1(0x117)](0x2));let _0x28c089=[];_0x1eecfe[_0x59e3d1(0x110)](_0x42176c=>{const _0x3a62a2=_0x59e3d1;_0x28c089[_0x3a62a2(0x10c)]({'key':_0x42176c[_0x3a62a2(0x18f)],..._0x42176c[_0x3a62a2(0x192)]()});}),_0x28c089[_0x59e3d1(0x191)]((_0x185f1f,_0x5c47d0)=>new Date(_0x5c47d0[_0x59e3d1(0x168)])-new Date(_0x185f1f[_0x59e3d1(0x168)]));if(_0x28c089['length']>0x1&&_0x28c089[0x0][_0x59e3d1(0x18f)]!==_0x3d8da7[_0x59e3d1(0x18f)]){const _0x2410a0=_0x28c089[0x1],_0x427f58=_0x2410a0['SF']+_0x3d8da7['V']-_0x3d8da7[_0x59e3d1(0x156)];await update(ref(db,'users-data/'+primaryUser+_0x59e3d1(0x146)+currentUser+'/'+_0x2410a0[_0x59e3d1(0x18f)]),{'SF':_0x427f58});}}catch(_0x284594){console['error']('Error\x20updating\x20stock\x20after\x20deletion:',_0x284594);}}function renderTable(_0x102af9){const _0x4dd611=_0x15fdc7,_0x3b81d6=salesTable[_0x4dd611(0x1a0)](_0x4dd611(0x15a));_0x3b81d6['innerHTML']='',_0x102af9[_0x4dd611(0x110)](_0x282ed1=>{const _0x56a61b=_0x4dd611,_0x4e9cc9=_0x3b81d6[_0x56a61b(0x166)]();_0x4e9cc9[_0x56a61b(0x149)]['key']=_0x282ed1[_0x56a61b(0x18f)],_0x4e9cc9[_0x56a61b(0x10d)](0x0)[_0x56a61b(0x14e)]=new Date(_0x282ed1[_0x56a61b(0x168)])[_0x56a61b(0x140)](),_0x4e9cc9[_0x56a61b(0x10d)](0x1)['textContent']=_0x282ed1[_0x56a61b(0xfc)],_0x4e9cc9['insertCell'](0x2)[_0x56a61b(0x14e)]=_0x282ed1['SI'],_0x4e9cc9['insertCell'](0x3)[_0x56a61b(0x14e)]=_0x282ed1['APP'],_0x4e9cc9[_0x56a61b(0x10d)](0x4)[_0x56a61b(0x14e)]=_0x282ed1['V'],_0x4e9cc9[_0x56a61b(0x10d)](0x5)['textContent']=_0x282ed1['SF'],_0x4e9cc9['insertCell'](0x6)[_0x56a61b(0x14e)]=_0x282ed1['PV'],_0x4e9cc9[_0x56a61b(0x10d)](0x7)[_0x56a61b(0x14e)]=_0x282ed1[_0x56a61b(0x198)];}),window[_0x4dd611(0x16c)]();}function _0x1836(){const _0x3690b0=['signupUsername','th[data-sort]','authSection','preventDefault','createElement','Error\x20updating\x20table.','<option\x20value=\x22\x22>Sélectionner\x20un\x20produit</option>','exportToExcel','signupForm','Prix\x20de\x20vente','7848393NtmUwI','onclick','exists','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Êtes-vous\x20sûr\x20de\x20vouloir\x20supprimer\x20cette\x20entrée\x20?</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22confirmDelete\x22>Confirmer</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22cancelDelete\x22>Annuler</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','toISOString','292641dolzra','Inscription\x20réussie\x20!\x20Connectez-vous.','product','password','showConfirmDialog','Erreur\x20lors\x20de\x20l\x27inscription','expired','prices','destroy','Détail\x20des\x20ventes','signupPassword','labels','filterSalesDates','dashboardContainer','Error\x20fetching\x20ticket\x20categories:','/secondaryUsers','inactive','add','push','insertCell','Entrée\x20supprimée\x20avec\x20succès','toString','forEach','redirectToSubscription','keys','setItem','book_append_sheet','index.html','No\x20data\x20available\x20at\x20TicketsTotal','limitToLast','filter','174394DjdNUq','Moyenne\x20des\x20ventes\x20par\x20jour:\x20','Utilisateur\x20introuvable','rgb(255,\x2099,\x20132)','then','User\x20not\x20logged\x20in.\x20Cannot\x20delete\x20entry.','signupButton','User\x20not\x20logged\x20in.\x20Cannot\x20check\x20subscription\x20status.','light-theme','writeFile','innerHTML','Error\x20updating\x20table:','salesDetailsSection','toUpperCase','Erreur\x20lors\x20de\x20la\x20suppression\x20de\x20l\x27entrée:','every','error','name','Total\x20des\x20ventes:\x20','search','addUserModal','subscriptionRequiredModal','change','display','toFixed','#searchInputs\x20input','averageSales','hideSubscriptionRequiredModal','setAttribute','rgb(0,\x20255,\x20255)','click','endAt','querySelectorAll','Veuillez\x20entrer\x20un\x20nom\x20d\x27utilisateur.','Analyse\x20des\x20ventes','remove','users-data/','slice','removeChild','toLocaleString','month','reset','currentUserId','DOMContentLoaded','Secondary\x20user\x20added\x20successfully.','/sales/','length','tbody\x20tr','dataset','darkTheme','none','users/','style','textContent','logout','/secondaryUsers/','log','getElementById','addUserIcon','location','/TicketsTotal','APP','3753815FJKWXn','12NwrHzR','4woMAnh','tbody','orderByChild','getContext','aria-label','userSelect','Error\x20adding\x20secondary\x20user:','filterStockDates','salesTable','span','input','delete-icon','block','insertRow','Error\x20adding\x20entry.','dateTime','Activer\x20le\x20mode\x20clair','\x20FCFA)','Subscription\x20check\x20error.','addDeleteIcons','appendChild','td:first-child','3922134RLEZmI','66771dAXQQN','loginFromSignup','documentElement','Vous\x20devez\x20être\x20connecté\x20pour\x20ajouter\x20une\x20opération.','option','/admin/subscription','User\x20not\x20logged\x20in.\x20Cannot\x20update\x20stock\x20tables.','status','includes','reduce','analysisSection','endDate','totalSales','confirmDelete','Mot\x20de\x20passe\x20incorrect','ventes_wifi_zone.xlsx','190SeDLei','body','Ce\x20nom\x20d\x27utilisateur\x20est\x20déjà\x20utilisé.','prix','Ventes','true','value','utils','className','values','theme-toggle','submit','confirm-dialog','showSubscriptionRequiredModal','addEventListener','key','922023FGAMcG','sort','val','getItem','sales','User\x20not\x20logged\x20in.\x20Cannot\x20update\x20stock\x20after\x20deletion.','cancelDelete','Error\x20adding\x20entry:','total','Subscription\x20check\x20error:','stockTableGlobal','loginForm','line','816EBgsjN','Masquer\x20l\x27analyse\x20des\x20ventes','Primary\x20user\x20not\x20logged\x20in.\x20Cannot\x20populate\x20user\x20select.','querySelector','\x20FCFA','getTime','Activer\x20le\x20mode\x20sombre','catch','Primary\x20user\x20not\x20logged\x20in.\x20Cannot\x20add\x20secondary\x20user.'];_0x1836=function(){return _0x3690b0;};return _0x1836();}function addDeleteIcons(){const _0x2ff4fd=_0x15fdc7,_0x1bf382=salesTable['querySelectorAll'](_0x2ff4fd(0x148));_0x1bf382['forEach'](_0x15b586=>{const _0x2c0c1a=_0x2ff4fd,_0x5a6148=document['createElement']('span');_0x5a6148[_0x2c0c1a(0x123)]='✖',_0x5a6148[_0x2c0c1a(0x188)]=_0x2c0c1a(0x164),_0x5a6148[_0x2c0c1a(0x1b1)]=_0x36311f=>{const _0x1c3f79=_0x2c0c1a;_0x36311f['stopPropagation'](),window[_0x1c3f79(0xfe)](_0x15b586[_0x1c3f79(0x149)][_0x1c3f79(0x18f)]);},_0x15b586[_0x2c0c1a(0x1a0)](_0x2c0c1a(0x16e))[_0x2c0c1a(0x16d)](_0x5a6148);});}function showConfirmDialog(_0x1a6feb){const _0x33ecb5=_0x15fdc7,_0xd0225d=document[_0x33ecb5(0x1aa)]('div');_0xd0225d[_0x33ecb5(0x188)]=_0x33ecb5(0x18c),_0xd0225d[_0x33ecb5(0x123)]=_0x33ecb5(0x1b3),document[_0x33ecb5(0x181)]['appendChild'](_0xd0225d),document[_0x33ecb5(0x152)](_0x33ecb5(0x17d))['onclick']=()=>{const _0x599b53=_0x33ecb5;deleteEntry(_0x1a6feb),document[_0x599b53(0x181)][_0x599b53(0x13f)](_0xd0225d);},document[_0x33ecb5(0x152)](_0x33ecb5(0x196))[_0x33ecb5(0x1b1)]=()=>{const _0x25b6da=_0x33ecb5;document[_0x25b6da(0x181)][_0x25b6da(0x13f)](_0xd0225d);};}function setupSearch(){const _0x571f2e=_0x15fdc7,_0x50f6fe=document[_0x571f2e(0x139)](_0x571f2e(0x132));_0x50f6fe[_0x571f2e(0x110)](_0x3c3a0c=>{const _0x4562b7=_0x571f2e;_0x3c3a0c[_0x4562b7(0x18e)](_0x4562b7(0x163),()=>{const _0x381bde=_0x4562b7,_0x2996c2=salesData[_0x381bde(0x118)](_0x5d29de=>{const _0x4cc5d7=_0x381bde;return Object[_0x4cc5d7(0x112)](_0x5d29de)[_0x4cc5d7(0x128)](_0x31a329=>{const _0x1ab578=_0x4cc5d7,_0x584c74=document[_0x1ab578(0x152)](_0x1ab578(0x12c)+(_0x31a329['charAt'](0x0)[_0x1ab578(0x126)]()+_0x31a329['slice'](0x1))),_0x5f42b1=_0x584c74?_0x584c74[_0x1ab578(0x186)]['toLowerCase']():'';return _0x5d29de[_0x31a329][_0x1ab578(0x10f)]()['toLowerCase']()[_0x1ab578(0x178)](_0x5f42b1);});});renderTable(_0x2996c2),updateAnalysis(_0x2996c2);});});}function setupSort(_0xc84541){const _0x2523d1=_0x15fdc7,_0x35d73c=_0xc84541[_0x2523d1(0x139)](_0x2523d1(0x1a7));_0x35d73c[_0x2523d1(0x110)](_0x2f6ace=>{const _0x4324a4=_0x2523d1;_0x2f6ace[_0x4324a4(0x18e)]('click',()=>{const _0x13a9ba=_0x4324a4,_0xcee4e4=_0x2f6ace[_0x13a9ba(0x149)]['sort'],_0x3d1365=_0xc84541['id']===_0x13a9ba(0x161)?salesData:stockData;_0x3d1365[_0x13a9ba(0x191)]((_0xfc22dd,_0x25a43c)=>{const _0x1f6cd3=isNaN(parseFloat(_0xfc22dd[_0xcee4e4]))?_0xfc22dd[_0xcee4e4]:parseFloat(_0xfc22dd[_0xcee4e4]),_0x58336e=isNaN(parseFloat(_0x25a43c[_0xcee4e4]))?_0x25a43c[_0xcee4e4]:parseFloat(_0x25a43c[_0xcee4e4]);if(_0x1f6cd3<_0x58336e)return-0x1;if(_0x1f6cd3>_0x58336e)return 0x1;return 0x0;}),_0xc84541['id']===_0x13a9ba(0x161)?(renderTable(_0x3d1365),updateAnalysis(_0x3d1365)):renderStockTable(_0x3d1365,_0xc84541);});});}function renderStockTable(_0x1291d5,_0x2030cd){const _0x351eb5=_0x15fdc7,_0x2f076d=_0x2030cd[_0x351eb5(0x1a0)](_0x351eb5(0x15a));_0x2f076d['innerHTML']='',_0x1291d5[_0x351eb5(0x110)](_0x466e88=>{const _0x1a59a2=_0x351eb5,_0x40ce32=_0x2f076d[_0x1a59a2(0x166)]();_0x40ce32[_0x1a59a2(0x10d)](0x0)[_0x1a59a2(0x14e)]=_0x466e88[_0x1a59a2(0xfc)],_0x40ce32['insertCell'](0x1)['textContent']=_0x466e88['SF'],_0x40ce32[_0x1a59a2(0x10d)](0x2)['textContent']=new Date(_0x466e88[_0x1a59a2(0x168)])[_0x1a59a2(0x140)]();});}function updateAnalysis(_0x4c3ec6=salesData){const _0x39f17c=_0x15fdc7;let _0x3461f6=0x0,_0x3f452f=0x0;const _0x99cf19={'labels':[],'sales':[],'prices':[]};_0x4c3ec6[_0x39f17c(0x110)](_0x11b458=>{const _0x8bb8de=_0x39f17c;_0x3461f6+=_0x11b458['V']*_0x11b458['PV'],_0x3f452f++,_0x99cf19[_0x8bb8de(0x105)][_0x8bb8de(0x10c)](new Date(_0x11b458['dateTime'])[_0x8bb8de(0x140)]()),_0x99cf19[_0x8bb8de(0x194)][_0x8bb8de(0x10c)](_0x11b458['V']),_0x99cf19['prices']['push'](_0x11b458['PV']);});const _0x2f8bd8=_0x3461f6/(_0x3f452f||0x1);totalSalesElement[_0x39f17c(0x14e)]='Total\x20des\x20ventes:\x20'+_0x3461f6[_0x39f17c(0x131)](0x2)+'\x20FCFA',averageSalesElement[_0x39f17c(0x14e)]=_0x39f17c(0x11a)+_0x2f8bd8[_0x39f17c(0x131)](0x2)+_0x39f17c(0x1a1),updateChart(_0x99cf19),updatePeriodAnalysis(_0x4c3ec6);}function updateChart(_0x1c7bef){const _0x52322d=_0x15fdc7,_0x23f7e2=document[_0x52322d(0x152)]('salesChart')[_0x52322d(0x15c)]('2d');salesChart&&salesChart[_0x52322d(0x102)](),salesChart=new Chart(_0x23f7e2,{'type':_0x52322d(0x19c),'data':{'labels':_0x1c7bef[_0x52322d(0x105)],'datasets':[{'label':'Ventes','data':_0x1c7bef[_0x52322d(0x194)],'borderColor':'rgb(0,\x20255,\x20255)','tension':0.1},{'label':_0x52322d(0x1af),'data':_0x1c7bef[_0x52322d(0x101)],'borderColor':_0x52322d(0x11c),'tension':0.1}]},'options':{'responsive':!![],'scales':{'y':{'beginAtZero':!![],'grid':{'color':'rgba(255,\x20255,\x20255,\x200.1)'},'ticks':{'color':'rgb(0,\x20255,\x20255)'}},'x':{'grid':{'color':'rgba(255,\x20255,\x20255,\x200.1)'},'ticks':{'color':_0x52322d(0x136)}}},'plugins':{'legend':{'labels':{'color':_0x52322d(0x136)}}}}});}function updatePeriodAnalysis(_0x5af68e){const _0xdcf2be=_0x15fdc7,_0x119c5d=new Date(),_0xe91a79=new Date(_0x119c5d[_0xdcf2be(0x1a2)]()-0x7*0x18*0x3c*0x3c*0x3e8),_0x575a39=new Date(_0x119c5d['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8),_0x555aad=new Date(_0x119c5d[_0xdcf2be(0x1a2)]()-0x5a*0x18*0x3c*0x3c*0x3e8),_0x3c50b3=_0x5af68e[_0xdcf2be(0x118)](_0x9c2c15=>new Date(_0x9c2c15[_0xdcf2be(0x168)])>=_0xe91a79),_0x1eca23=_0x5af68e[_0xdcf2be(0x118)](_0x63eb92=>new Date(_0x63eb92[_0xdcf2be(0x168)])>=_0x575a39),_0x20c456=_0x5af68e[_0xdcf2be(0x118)](_0x55e40a=>new Date(_0x55e40a[_0xdcf2be(0x168)])>=_0x555aad);updatePeriodStats(_0x3c50b3,'week'),updatePeriodStats(_0x1eca23,_0xdcf2be(0x141)),updatePeriodStats(_0x20c456,'threeMonth');}function updatePeriodStats(_0x3f6a1a,_0x299143){const _0x3b6d67=_0x15fdc7,_0x20661f=_0x3f6a1a[_0x3b6d67(0x179)]((_0x61f5e8,_0x48cdbb)=>_0x61f5e8+_0x48cdbb['V']*_0x48cdbb['PV'],0x0),_0x6d3ff3=_0x20661f/(_0x3f6a1a[_0x3b6d67(0x147)]||0x1);document[_0x3b6d67(0x152)](_0x299143+'TotalSales')[_0x3b6d67(0x14e)]=_0x3b6d67(0x12b)+_0x20661f[_0x3b6d67(0x131)](0x2)+_0x3b6d67(0x1a1),document['getElementById'](_0x299143+'AverageSales')[_0x3b6d67(0x14e)]=_0x3b6d67(0x11a)+_0x6d3ff3[_0x3b6d67(0x131)](0x2)+_0x3b6d67(0x1a1);}let isDarkTheme=!![];function setTheme(_0x344e4c){const _0x3fa4d9=_0x15fdc7;_0x344e4c?(document['documentElement']['classList'][_0x3fa4d9(0x13c)](_0x3fa4d9(0x121)),themeToggle['textContent']='🌙',themeToggle[_0x3fa4d9(0x135)](_0x3fa4d9(0x15d),_0x3fa4d9(0x169))):(document[_0x3fa4d9(0x172)]['classList'][_0x3fa4d9(0x10b)](_0x3fa4d9(0x121)),themeToggle['textContent']='☀️',themeToggle[_0x3fa4d9(0x135)](_0x3fa4d9(0x15d),_0x3fa4d9(0x1a3))),isDarkTheme=_0x344e4c,localStorage[_0x3fa4d9(0x113)](_0x3fa4d9(0x14a),_0x344e4c);}function showSubscriptionRequiredModal(){const _0x17d6e1=_0x15fdc7;document[_0x17d6e1(0x152)]('subscriptionRequiredModal')[_0x17d6e1(0x14d)]['display']='flex';}window['hideSubscriptionRequiredModal']=function(){const _0x2d2dea=_0x15fdc7;document[_0x2d2dea(0x152)](_0x2d2dea(0x12e))['style'][_0x2d2dea(0x130)]='none';},window[_0x15fdc7(0x111)]=function(){const _0x24d6b5=_0x15fdc7;window[_0x24d6b5(0x154)]['href']=_0x24d6b5(0x115);};async function checkSubscriptionStatus(){const _0x4ba4fb=_0x15fdc7;if(!primaryUser)return console[_0x4ba4fb(0x129)](_0x4ba4fb(0x120)),![];try{const _0xad92b4=await get(ref(db,_0x4ba4fb(0x13d)+primaryUser+_0x4ba4fb(0x175))),_0x476f2a=_0xad92b4[_0x4ba4fb(0x192)](),_0x1043ad=new Date();if(_0x476f2a&&_0x476f2a[_0x4ba4fb(0x177)]==='active'){const _0x51d6b7=new Date(_0x476f2a[_0x4ba4fb(0x17b)]);return _0x51d6b7>=_0x1043ad?!![]:(await update(ref(db,'users-data/'+primaryUser+_0x4ba4fb(0x175)),{'status':_0x4ba4fb(0x100)}),![]);}else return![];}catch(_0x1ee418){console[_0x4ba4fb(0x129)](_0x4ba4fb(0x199),_0x1ee418);throw _0x1ee418;}}function showAuthSection(){const _0x330c5b=_0x15fdc7;authSection['style'][_0x330c5b(0x130)]=_0x330c5b(0x165),dashboardContainer['style'][_0x330c5b(0x130)]=_0x330c5b(0x14b),userInfoElement[_0x330c5b(0x14e)]='',salesForm[_0x330c5b(0x142)]();}function showLoginForm(){const _0x248333=_0x15fdc7;document['getElementById'](_0x248333(0x19b))[_0x248333(0x14d)][_0x248333(0x130)]='block',document[_0x248333(0x152)]('signupForm')[_0x248333(0x14d)][_0x248333(0x130)]=_0x248333(0x14b);}function showSignupForm(){const _0x33a504=_0x15fdc7;document['getElementById'](_0x33a504(0x19b))[_0x33a504(0x14d)][_0x33a504(0x130)]='none',document[_0x33a504(0x152)](_0x33a504(0x1ae))['style'][_0x33a504(0x130)]=_0x33a504(0x165);}function setupAuthEventListeners(){const _0x3a42b8=_0x15fdc7,_0x589ed5=document['getElementById'](_0x3a42b8(0x19b)),_0x53ca75=document[_0x3a42b8(0x152)](_0x3a42b8(0x1ae));_0x589ed5[_0x3a42b8(0x18e)](_0x3a42b8(0x18b),function(_0x45891f){const _0x3fcbeb=_0x3a42b8;_0x45891f[_0x3fcbeb(0x1a9)]();const _0x1275a3=document[_0x3fcbeb(0x152)]('username')[_0x3fcbeb(0x186)],_0x583c28=document['getElementById'](_0x3fcbeb(0xfd))['value'];get(ref(db,_0x3fcbeb(0x14c)+_0x1275a3))['then'](_0x13c85a=>{const _0x36d0e2=_0x3fcbeb;_0x13c85a[_0x36d0e2(0x1b2)]()?_0x13c85a[_0x36d0e2(0x192)]()[_0x36d0e2(0xfd)]===_0x583c28?(sessionStorage[_0x36d0e2(0x113)]('isLoggedIn',_0x36d0e2(0x185)),sessionStorage[_0x36d0e2(0x113)](_0x36d0e2(0x143),_0x1275a3),loginSuccess(_0x1275a3,!![])):alert(_0x36d0e2(0x17e)):alert(_0x36d0e2(0x11b));});}),_0x53ca75[_0x3a42b8(0x18e)](_0x3a42b8(0x18b),function(_0x57d6ff){const _0x1263d1=_0x3a42b8;_0x57d6ff[_0x1263d1(0x1a9)]();const _0x1051a2=document['getElementById'](_0x1263d1(0x1a6))[_0x1263d1(0x186)],_0x3cbaa2=document[_0x1263d1(0x152)](_0x1263d1(0x104))[_0x1263d1(0x186)];get(ref(db,_0x1263d1(0x14c)+_0x1051a2))['then'](_0x14c611=>{const _0x3c519f=_0x1263d1;_0x14c611[_0x3c519f(0x1b2)]()?alert(_0x3c519f(0x182)):set(ref(db,_0x3c519f(0x14c)+_0x1051a2),{'password':_0x3cbaa2})[_0x3c519f(0x11d)](()=>{const _0x4d3098=_0x3c519f,_0x35116f=ref(db,_0x4d3098(0x13d)+_0x1051a2);return set(_0x35116f,{'admin':{'subscription':{'status':_0x4d3098(0x10a)}},'TicketsTotal':{},'TicketsVendus':{},'TicketsTransit':{},'TicketConnecté':{},'Vendors':{},'VendorsHistory':{},'sales':{},'secondaryUsers':{}});})[_0x3c519f(0x11d)](()=>{const _0x162388=_0x3c519f;alert(_0x162388(0xfb)),showLoginForm();})[_0x3c519f(0x1a4)](_0x4a5bbd=>{const _0x23ba0f=_0x3c519f;console[_0x23ba0f(0x129)]('Error\x20during\x20signup:',_0x4a5bbd),alert(_0x23ba0f(0xff));});});}),signupButton[_0x3a42b8(0x18e)](_0x3a42b8(0x137),function(){showSignupForm();}),loginFromSignup[_0x3a42b8(0x18e)](_0x3a42b8(0x137),function(){showLoginForm();});}function setupEventListeners(){const _0xcfaea2=_0x15fdc7;productSelect[_0xcfaea2(0x18e)]('change',async function(){const _0x18efc8=_0xcfaea2,_0x1a164b=this[_0x18efc8(0x186)];if(!_0x1a164b){document[_0x18efc8(0x152)]('SI')[_0x18efc8(0x186)]='',document[_0x18efc8(0x152)]('PV')[_0x18efc8(0x186)]='',updateSF();return;}updatePV();try{const _0x5d3e89=await get(ref(db,_0x18efc8(0x13d)+primaryUser+_0x18efc8(0x146)+currentUser));if(_0x5d3e89[_0x18efc8(0x1b2)]()){let _0x30b7b0=0x0,_0x16f7ac=new Date(0x0);_0x5d3e89[_0x18efc8(0x110)](_0x2f16b7=>{const _0x3fcd6e=_0x18efc8,_0x3c1f70=_0x2f16b7[_0x3fcd6e(0x192)]();if(_0x3c1f70[_0x3fcd6e(0xfc)]===_0x1a164b){const _0x532c34=new Date(_0x3c1f70[_0x3fcd6e(0x168)]);_0x532c34>_0x16f7ac&&(_0x16f7ac=_0x532c34,_0x30b7b0=_0x3c1f70['SF']);}}),document[_0x18efc8(0x152)]('SI')['value']=_0x30b7b0;}else document[_0x18efc8(0x152)]('SI')[_0x18efc8(0x186)]=0x0;}catch(_0x5cec38){console[_0x18efc8(0x129)]('Erreur\x20lors\x20de\x20la\x20récupération\x20du\x20dernier\x20stock:',_0x5cec38),document['getElementById']('SI')['value']=0x0;}updateSF();}),document[_0xcfaea2(0x152)]('V')[_0xcfaea2(0x18e)]('input',updateSF),document[_0xcfaea2(0x152)]('APP')[_0xcfaea2(0x18e)]('input',updateSF),salesForm['addEventListener']('submit',function(_0x3d729d){const _0xc5569=_0xcfaea2;_0x3d729d['preventDefault']();if(!currentUser){alert(_0xc5569(0x173));return;}const _0x1ee462={'dateTime':document[_0xc5569(0x152)](_0xc5569(0x168))[_0xc5569(0x186)],'product':document[_0xc5569(0x152)]('product')['value'],'SI':parseInt(document[_0xc5569(0x152)]('SI')['value'])||0x0,'APP':parseInt(document[_0xc5569(0x152)](_0xc5569(0x156))[_0xc5569(0x186)])||0x0,'V':parseInt(document['getElementById']('V')[_0xc5569(0x186)])||0x0,'SF':parseInt(document[_0xc5569(0x152)]('SF')[_0xc5569(0x186)])||0x0,'PV':parseFloat(document[_0xc5569(0x152)]('PV')[_0xc5569(0x186)])||0x0};push(ref(db,_0xc5569(0x13d)+primaryUser+_0xc5569(0x146)+currentUser),_0x1ee462)[_0xc5569(0x11d)](()=>{const _0x17ad15=_0xc5569;updateTable(),updateStockTables(),updateAnalysis(),salesForm['reset'](),document[_0x17ad15(0x152)]('dateTime')[_0x17ad15(0x186)]=new Date()[_0x17ad15(0xf9)]()[_0x17ad15(0x13e)](0x0,0x10);})[_0xc5569(0x1a4)](_0x10e78a=>{const _0xbfc6ba=_0xc5569;console[_0xbfc6ba(0x129)](_0xbfc6ba(0x197),_0x10e78a),alert(_0xbfc6ba(0x167));});}),toggleAnalysisButton[_0xcfaea2(0x18e)](_0xcfaea2(0x137),function(){const _0x31d75f=_0xcfaea2;analysisSection['style'][_0x31d75f(0x130)]==='none'||analysisSection[_0x31d75f(0x14d)][_0x31d75f(0x130)]===''?(analysisSection['style'][_0x31d75f(0x130)]=_0x31d75f(0x165),salesDetailsSection['style'][_0x31d75f(0x130)]=_0x31d75f(0x14b),this[_0x31d75f(0x14e)]=_0x31d75f(0x19e),toggleSalesButton[_0x31d75f(0x14e)]=_0x31d75f(0x103),updateAnalysis(salesData)):(analysisSection[_0x31d75f(0x14d)]['display']=_0x31d75f(0x14b),this[_0x31d75f(0x14e)]=_0x31d75f(0x13b));}),toggleSalesButton['addEventListener']('click',function(){const _0xf6a038=_0xcfaea2;salesDetailsSection['style'][_0xf6a038(0x130)]===_0xf6a038(0x14b)||salesDetailsSection[_0xf6a038(0x14d)][_0xf6a038(0x130)]===''?(salesDetailsSection['style'][_0xf6a038(0x130)]=_0xf6a038(0x165),analysisSection[_0xf6a038(0x14d)][_0xf6a038(0x130)]=_0xf6a038(0x14b),this[_0xf6a038(0x14e)]='Masquer\x20le\x20détail\x20des\x20ventes',toggleAnalysisButton['textContent']=_0xf6a038(0x13b)):(salesDetailsSection[_0xf6a038(0x14d)][_0xf6a038(0x130)]=_0xf6a038(0x14b),this['textContent']=_0xf6a038(0x103));}),themeToggle['addEventListener'](_0xcfaea2(0x137),()=>{setTheme(!isDarkTheme);}),document['getElementById'](_0xcfaea2(0x160))['addEventListener'](_0xcfaea2(0x137),function(){const _0x305d49=_0xcfaea2,_0x361e08=new Date(document[_0x305d49(0x152)]('stockStartDate')[_0x305d49(0x186)]),_0x2ba306=new Date(document[_0x305d49(0x152)]('stockEndDate')[_0x305d49(0x186)]);updateStockTables(_0x361e08,_0x2ba306);}),document[_0xcfaea2(0x152)](_0xcfaea2(0x106))[_0xcfaea2(0x18e)]('click',function(){const _0xed6a13=_0xcfaea2,_0x535d2e=new Date(document[_0xed6a13(0x152)]('salesStartDate')[_0xed6a13(0x186)]),_0x118d5f=new Date(document[_0xed6a13(0x152)]('salesEndDate')['value']),_0x5844c5=salesData[_0xed6a13(0x118)](_0x21c98c=>{const _0x2667e8=new Date(_0x21c98c['dateTime']);return(!_0x535d2e||_0x2667e8>=_0x535d2e)&&(!_0x118d5f||_0x2667e8<=_0x118d5f);});renderTable(_0x5844c5),updateAnalysis(_0x5844c5);}),addUserIcon[_0xcfaea2(0x18e)](_0xcfaea2(0x137),()=>{const _0x566ef1=_0xcfaea2;addUserModal[_0x566ef1(0x14d)][_0x566ef1(0x130)]=_0x566ef1(0x165);}),addUserForm[_0xcfaea2(0x18e)]('submit',_0x2aa035=>{_0x2aa035['preventDefault'](),addSecondaryUser(newUserNameInput['value']);}),userSelect[_0xcfaea2(0x18e)](_0xcfaea2(0x12f),()=>{const _0x5d00f4=_0xcfaea2;switchUser(userSelect[_0x5d00f4(0x186)]);});}window[_0x15fdc7(0xfe)]=showConfirmDialog,window[_0x15fdc7(0x16c)]=addDeleteIcons,window[_0x15fdc7(0x134)]=hideSubscriptionRequiredModal,window[_0x15fdc7(0x111)]=redirectToSubscription,window[_0x15fdc7(0x1ad)]=exportToExcel,window[_0x15fdc7(0x14f)]=function(){sessionStorage['clear'](),showAuthSection(),currentUser=null,primaryUser=null;};
</script>
</body>
</html>