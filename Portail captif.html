<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexion Cyber Campus</title>
    <style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Poppins', sans-serif;
}

body {
    background: linear-gradient(135deg, #36ff03, #1900ff, #a7ff03);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    color: #ffffff;
    overflow-x: hidden;
}

.container {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 10px;
}

header {
    background-color: rgba(0, 0, 0, 0.5);
    padding: 20px 0;
    position: relative;
    overflow: hidden;
}

.header-image {
    width: 100%;
    height: 300px;
    object-fit: cover;
    position: absolute;
    top: 0;
    left: 0;
    z-index: -1;
}

.img1 {
    animation: slide1 10s linear infinite;
}

.img2 {
    animation: slide2 10s linear infinite;
}

.logo {
    font-size: 2.5em;
    color: white;
    text-align: center;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    position: relative;
    z-index: 2;
}

.logo::before {
    content: '';
    font-size: 0.8em;
    margin-right: 10px;
    animation: rotate 5s linear infinite;
    display: inline-block;
}

@keyframes rotate {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.moon {
    position: absolute;
    top: 20px;
    right: 20px;
    font-size: 2em;
    animation: float 3s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

nav {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 20px;
    padding: 0 10px;
    flex-wrap: wrap;
}

.nav-button {
    background-color: rgba(0, 0, 0, 0.952);
    color: rgb(255, 255, 255);
    border: none;
    padding: 10px 20px;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
    width: auto;
    min-width: 150px;
    text-align: center;
    margin: 5px;
}

.nav-button::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background-color: rgb(0, 0, 0);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    transition: width 0.5s, height 0.5s;
}

.nav-button:hover::before {
    width: 300px;
    height: 300px;
}

@keyframes buttonPulse {
    0% { background-color: #020202; color: #ffffff; }
    50% { background-color: #1a2a6c; color: #c8ff00; }
    100% { background-color: #000000; color: #ffffff; }
}

.nav-button.animate-pay {
    animation: buttonPulse 3s ease-in-out infinite;
}

@keyframes textChange {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
}

main {
    display: flex;
    flex-direction: column;
    padding: 20px 10px;
    gap: 20px;
    flex: 1;
}

.login-section,
.rates-section,
.locations-section,
.products-section {
    background-color: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s, box-shadow 0.3s;
}

section:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 8px rgba(0, 0, 0, 0.2);
}

.login-section {
    width: 100%;
    max-width: 500px;
    margin: 0 auto;
}

h2 {
    color: rgb(0, 0, 0);
    margin-bottom: 15px;
    position: relative;
    display: inline-block;
}

h2::after {
    content: '';
    position: absolute;
    bottom: -5px;
    left: 0;
    width: 0;
    height: 2px;
    background-color: #fdbb2d;
    transition: width 0.3s;
}

section:hover h2::after {
    width: 100%;
}

form {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

input {
    margin-bottom: 10px;
    padding: 12px;
    border: none;
    border-radius: 25px;
    background-color: rgb(255, 253, 250);
    color: rgb(0, 0, 0);
    transition: background-color 0.3s;
}

input:focus {
    background-color: rgba(255, 255, 255, 0.3);
    outline: none;
}

button {
    background-color: #000000;
    color: #ffffff;
    border: none;
    padding: 10px;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s;
    font-weight: bold;
}

button:hover {
    background-color: #1a2a6c;
    color: #fdbb2d;
}

.rates-section {
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
}

.rates-section table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    margin: 10px 0;
}

.rates-section th,
.rates-section td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
}

.rates-section th:first-child,
.rates-section td:first-child {
    padding-left: 20px;
}

.rates-section th:last-child,
.rates-section td:last-child {
    padding-right: 20px;
}

.rates-section .loading-message {
    text-align: center;
    padding: 20px;
}

ul {
    list-style-type: none;
}

li {
    margin-bottom: 10px;
    position: relative;
    padding-left: 20px;
}

li::before {
    content: '‚û§';
    position: absolute;
    left: 0;
    color: #fdbb2d;
}

footer {
    background-color: rgba(0, 0, 0, 0.5);
    padding: 15px;
    text-align: center;
    margin-top: auto;
}

.notification {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
    z-index: 1000;
    display: none;
    color: #1a2a6c;
    text-align: center;
    width: 90%;
    max-width: 400px;
}

.notification h2 {
    color: #1a2a6c;
    margin-bottom: 20px;
}

.notification p {
    margin-bottom: 15px;
}

.close-icon {
    position: absolute;
    top: 10px;
    right: 10px;
    cursor: pointer;
    font-size: 20px;
}

.notification .ticket-info {
    margin-bottom: 15px;
    text-align: left;
}

.notification .ticket-info p {
    margin-bottom: 5px;
}

.notification .login-button,
.notification .delete-button {
    display: inline-block;
    margin: 0 10px;
}

.notification .login-button {
    background-color: #fdbb2d;
    color: #1a2a6c;
}

.delete-button {
    background-color: #f44336;
    color: white;
}

.delete-button:hover {
    background-color: #d32f2f;
}

.notification.error {
    background-color: #fdd;
    border: 1px solid #faa;
    color: #f00;
}

/* Footer Popup Styles */
.footer-popup {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translate(-50%, 200%);
    width: 95%;
    max-width: 600px;
    padding: 2rem;
    border-radius: 25px;
    z-index: 1000;
    opacity: 0;
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    background: linear-gradient(135deg, rgba(129, 0, 0, 0.95) 0%, rgba(0, 60, 150, 0.95) 100%);
    backdrop-filter: blur(10px);
    color: white;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(0, 89, 255, 0.3),
                inset 0 0 60px rgba(0, 89, 255, 0.1);
    max-height: 85vh;
    overflow-y: auto;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.footer-popup.show {
    transform: translate(-50%, 0);
    opacity: 1;
}

.footer-popup .close-btn {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: rgba(255, 255, 255, 0.15);
    border: none;
    color: white;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

/* Animations */
@keyframes slide1 {
    0% { transform: translateX(0); }
    50% { transform: translateX(-100%); }
    100% { transform: translateX(0); }
}

@keyframes slide2 {
    0% { transform: translateX(100%); }
    50% { transform: translateX(0); }
    100% { transform: translateX(100%); }
}

/* Media Queries */
@media screen and (max-width: 768px) {
    .container {
        padding: 5px;
    }

    .logo {
        font-size: 2em;
    }

    nav {
        flex-direction: column;
        padding: 0 15px;
    }

    .nav-button {
        width: 100%;
        margin: 5px 0;
    }

    main {
        padding: 10px 5px;
    }

    .login-section,
    .rates-section,
    .locations-section,
    .products-section {
        padding: 15px;
        margin-bottom: 15px;
    }

    .rates-section {
        margin: 0 -5px;
        width: calc(100% + 10px);
        border-radius: 0;
    }

    .rates-section table {
        font-size: 14px;
    }

    .rates-section th,
    .rates-section td {
        padding: 8px;
    }

    .footer-popup {
        width: 92%;
        padding: 1.5rem;
    }
}

@media screen and (max-width: 480px) {
    .logo {
        font-size: 1.8em;
    }

    h2 {
        font-size: 1.2em;
    }

    .rates-section th,
    .rates-section td {
        padding: 6px;
        font-size: 12px;
    }

    .notification {
        width: 95%;
        padding: 15px;
    }
}

nav {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 20px;
    padding: 0 10px;
    flex-wrap: nowrap; /* Emp√™che le retour √† la ligne */
}

.nav-button {
    background-color: rgba(0, 0, 0, 0.952);
    color: rgb(255, 255, 255);
    border: none;
    padding: 10px 15px;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
    width: auto;
    min-width: 0; /* Supprime la largeur minimale */
    text-align: center;
    margin: 5px;
    white-space: nowrap; /* Emp√™che le texte de passer √† la ligne */
    font-size: 14px; /* Taille de police r√©duite pour mobile */
    flex: 1; /* Les boutons se partagent l'espace disponible */
    max-width: calc(50% - 10px); /* Maximum 50% de la largeur moins la marge */
}

/* Modification des media queries */
@media screen and (max-width: 768px) {
    nav {
        flex-direction: row; /* Force l'alignement horizontal */
        padding: 0 10px;
    }

    .nav-button {
        width: auto; /* Permet aux boutons de s'adapter √† leur contenu */
        margin: 5px;
        font-size: 12px; /* Taille de police encore plus petite pour les tr√®s petits √©crans */
    }
}

@media screen and (max-width: 320px) {
    .nav-button {
        padding: 8px 12px; /* Padding r√©duit pour les tr√®s petits √©crans */
        font-size: 11px;
    }
}
    </style>

    $(if chap-id)
    <form name="sendin" action="$(link-login-only)" method="post" style="display:none">
        <input type="hidden" name="username" />
        <input type="hidden" name="password" />
        <input type="hidden" name="dst" value="$(link-orig)" />
        <input type="hidden" name="popup" value="true" />
    </form>

    <script src="/md5.js"></script>
    <script>
        function doLogin() {
            document.sendin.username.value = document.login.username.value;
            document.sendin.password.value = hexMD5('$(chap-id)' + document.login.password.value + '$(chap-challenge)');
            document.sendin.submit();
            return false;
        }
    </script>
    $(endif)
    <script src="https://cdn.fedapay.com/checkout.js?v=1.1.7"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getDatabase, ref, get, set, push, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
 
        const firebaseConfig = {
  apiKey: "AIzaSyB6AUBnK_7Vy2ABWI2JMo3ebG_Sljr8XlY",
  authDomain: "cyber-campus-2706f.firebaseapp.com",
  databaseURL: "https://cyber-campus-2706f-default-rtdb.firebaseio.com",
  projectId: "cyber-campus-2706f",
  storageBucket: "cyber-campus-2706f.appspot.com",
  messagingSenderId: "719410601264",
  appId: "1:719410601264:web:44fd2e3757721866303cf5",
  measurementId: "G-CEEFJP5LYZ"
};

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const adminRef = ref(db, 'admin/subscription');

        let localTickets = {};

        // Fonction pour v√©rifier le statut de l'abonnement
        async function checkSubscriptionStatus() {
            try {
                const snapshot = await get(adminRef);
                const subscription = snapshot.val();
                const now = new Date();

                if (subscription && subscription.status === 'active') {
                    const endDate = new Date(subscription.endDate);
                    if (endDate < now) {
                        // Abonnement expir√©
                        await adminRef.update({ status: 'expired' });
                        return false;
                    } else {
                        // Abonnement actif
                        return true;
                    }
                } else {
                    // Pas d'abonnement
                    return false;
                }
            } catch (error) {
                console.error("Erreur lors de la v√©rification de l'abonnement :", error);
                return false;
            }
        }

        // Fonction pour synchroniser les tickets
        async function syncTickets() {
            try {
                const isActive = await checkSubscriptionStatus();
                if (!isActive) {
                    document.querySelector('.rates-section .loading-message').textContent = 'Pas d\'abonnement actif';
                    return;
                }

                const ticketsTotalRef = ref(db, 'TicketsTotal');
                const snapshot = await get(ticketsTotalRef);
                localTickets = snapshot.val() || {};

                const ticketsVendusRef = ref(db, 'TicketsVendus');
                const snapshotVendus = await get(ticketsVendusRef);
                const ticketsVendus = snapshotVendus.val() || {};

                for (const ticketId in ticketsVendus) {
                    const ticketVendu = ticketsVendus[ticketId];
                    const ticketName = Object.keys(localTickets).find(
                        (key) => localTickets[key].utilisateur.includes(ticketVendu.user)
                    );

                    if (ticketName) {
                        const ticketIndex = localTickets[ticketName].utilisateur.indexOf(ticketVendu.user);

                        if (ticketIndex > -1) {
                            localTickets[ticketName].utilisateur.splice(ticketIndex, 1);
                            localTickets[ticketName].motDePasse.splice(ticketIndex, 1);
                            localTickets[ticketName].prix.splice(ticketIndex, 1);

                            if (localTickets[ticketName].utilisateur.length === 0) {
                                delete localTickets[ticketName];
                            }
                        }
                    }
                }

                console.log("Donn√©es synchronis√©es:", localTickets);
                createTicketTable();
            } catch (error) {
                console.error("Erreur lors de la synchronisation des tickets:", error);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            syncTickets();
            setInterval(syncTickets, 5000);
        });

        // Fonction pour stocker le ticket de connexion localement
        function storeLoginTicket(username, password) {
            localStorage.setItem('TicketConnect√©', JSON.stringify({
                user: username,
                password: password
            }));
            console.log("Ticket de connexion stock√©:", username);
        }

   // √âcouteur d'√©v√©nement pour le formulaire de connexion (sans chap-id) - Mise √† jour
   document.login.addEventListener('submit', function(event) {
        event.preventDefault();
        const username = document.login.username.value;
        const password = document.login.password.value;

        // Si chap-id est pr√©sent, utiliser doLogin() sinon connexion standard
        if (typeof hexMD5 === 'function') { // V√©rifier si hexMD5 est d√©fini (indique la pr√©sence de chap-id)
            doLogin();
            storeConnectedTicket(username); // Stocker le nom d'utilisateur dans Firebase
        } else {
            // Connexion standard
            storeLoginTicket(username, password); // Stockage local
            storeConnectedTicket(username); // Stocker le nom d'utilisateur dans Firebase
            this.submit();
        }
    });
        // Fonction pour g√©rer le stockage des tickets en transit
        async function storeTicketEnTransit(category) {
            const ticket = await synchronizeAndReserveTicket(category);
            if (!ticket) {
                throw new Error("Aucun ticket disponible pour cette cat√©gorie.");
            }

            const transitRef = ref(db, 'TicketsTransit');
            const newTicketRef = push(transitRef);
            await set(newTicketRef, {
                id: newTicketRef.key,
                category: category,
                ...ticket
            });
            console.log("Ticket en transit stock√©:", newTicketRef.key);
            return { id: newTicketRef.key, ...ticket };
        }

        // Fonction pour supprimer un ticket en transit
        async function removeTicketFromTransit(ticketId) {
            const transitRef = ref(db, `TicketsTransit/${ticketId}`);
            await remove(transitRef);
            console.log("Ticket en transit supprim√©:", ticketId);
        }

        // Fonction pour synchroniser et r√©server un ticket
        async function synchronizeAndReserveTicket(category) {
            try {
                const ticketsTotalRef = ref(db, `TicketsTotal/${category}`);
                const snapshot = await get(ticketsTotalRef);
                const ticketData = snapshot.val();

                if (!ticketData || ticketData.utilisateur.length === 0) {
                    return null;
                }

                const reservedTicket = {
                    user: ticketData.utilisateur[0],
                    password: ticketData.motDePasse[0],
                    price: ticketData.prix[0]
                };

                const updatedTicketData = {
                    ...ticketData,
                    utilisateur: ticketData.utilisateur.slice(1),
                    motDePasse: ticketData.motDePasse.slice(1),
                    prix: ticketData.prix.slice(1)
                };

                await set(ticketsTotalRef, updatedTicketData);
                return reservedTicket;
            } catch (error) {
                console.error("Erreur lors de la synchronisation et r√©servation du ticket:", error);
                throw error;
            }
        }

        // Fonction pour restaurer un ticket si le paiement √©choue
        async function restoreTicket(category, ticket) {
            const ticketsTotalRef = ref(db, `TicketsTotal/${category}`);
            const snapshot = await get(ticketsTotalRef);
            const ticketData = snapshot.val() || { utilisateur: [], motDePasse: [], prix: [] };

            ticketData.utilisateur.unshift(ticket.user);
            ticketData.motDePasse.unshift(ticket.password);
            ticketData.prix.unshift(ticket.price);

            await set(ticketsTotalRef, ticketData);
        }

        // Fonction pour v√©rifier si l'utilisateur peut obtenir un ticket gratuit
        function canGetFreeTicket() {
            const lastFreeTicket = localStorage.getItem('lastFreeTicket');
            if (!lastFreeTicket) return true;

            const lastTicketDate = new Date(parseInt(lastFreeTicket));
            const now = new Date();
            const diffDays = Math.floor((now - lastTicketDate) / (1000 * 60 * 60 * 24));

            return diffDays >= 7;
        }

        // Fonction initPayment modifi√©e
        window.initPayment = async function(category, amount, lienPaiement) {
            let ticketEnTransit = null;
            try {
                if (category.toLowerCase().includes('ticket cadeau')) {
                    if (!canGetFreeTicket()) {
                        showNotification(
                            "Non disponible",
                            "Vous devez attendre 7 jours entre chaque ticket gratuit.",
                            false
                        );
                        return;
                    }

                    const reservedTicket = await synchronizeAndReserveTicket(category);
                    localStorage.setItem('lastFreeTicket', Date.now().toString());
                    showNotification(
                        "Ticket cadeau",
                        "F√©licitations ! Vous avez re√ßu un ticket gratuit.",
                        true
                    );
                    displayTicket(reservedTicket, category);
                    await storeTicketVendu(reservedTicket);
                    return;
                }

                ticketEnTransit = await storeTicketEnTransit(category);
                const description = `${category}; ${ticketEnTransit.user} de ${ticketEnTransit.price} FCFA`;

                var fedaPayInstance = FedaPay.init({
                    public_key: 'pk_live_TfSz212W0xSMKK7oPEogkFmp',
                    transaction: {
                        amount: amount,
                        description: description
                    },
                    customer: {
                        email: 'client@example.com'
                    },
                    onComplete: async function(response) {
                        if (response.reason === FedaPay.DIALOG_DISMISSED) {
                            showNotification("Paiement annul√©", "Le paiement a √©t√© annul√©.");
                            await restoreTicket(category, ticketEnTransit);
                            await removeTicketFromTransit(ticketEnTransit.id);
                        } else if (response.reason === FedaPay.CHECKOUT_COMPLETED) {
                            const successDescription = `‚úÖ Paiement valid√© pour:\nPseudo: ${ticketEnTransit.user}\nMot de passe: ${ticketEnTransit.password}\nCat√©gorie: ${category}\nPrix: ${ticketEnTransit.price} FCFA\nMerci pour votre achat! üéâ`;
                            showNotification("Paiement r√©ussi", successDescription);
                            displayTicket(ticketEnTransit, category);
                            await storeTicketVendu(ticketEnTransit);
                        }
                    }
                });
                fedaPayInstance.open();
            } catch (error) {
                console.error("Erreur lors de l'initialisation du paiement:", error);
                showNotification("Erreur", "Une erreur est survenue. Veuillez r√©essayer plus tard.");
                if (ticketEnTransit) {
                    await restoreTicket(category, ticketEnTransit);
                    await removeTicketFromTransit(ticketEnTransit.id);
                }
            }
        };

        function showTariffsTable() {
            const tariffsTable = document.querySelector('.rates-section table');
            const loadingMessage = document.querySelector('.rates-section .loading-message');
            tariffsTable.style.display = 'table';
            loadingMessage.style.display = 'none';
        }

        async function createTicketTable() {
            const table = document.querySelector('.rates-section table');
            table.innerHTML = `
                <tr>
                    <th>Cat√©gorie</th>
                    <th>Prix (FCFA)</th>
                    <th>Action</th>
                </tr>
            `;

            for (const [category, data] of Object.entries(localTickets)) {
                const price = data.prix[0];
                const lienPaiement = data.lienPaiement;
                const row = table.insertRow();
                const buttonText = category.toLowerCase().includes('ticket cadeau') ? 'Obtenir' : 'Payer';
                
                row.innerHTML = `
                    <td>${category}</td>
                    <td>${price}</td>
                    <td><button onclick="initPayment('${category}', ${price}, '${lienPaiement}')">${buttonText}</button></td>
                `;
            }

            showTariffsTable();
        }

        // Fonction pour afficher la notification avec les boutons
function showTicketNotification(ticket) {
    const notification = document.getElementById('notification');
    const notificationTitle = document.getElementById('notification-title');
    const notificationMessage = document.getElementById('notification-message');

    notificationTitle.textContent = 'Votre ticket';
    notificationMessage.innerHTML = `
        <div class="ticket-info">
            <p>Nom d'utilisateur: ${ticket.user}</p>
            <p>Mot de passe: ${ticket.password}</p>
            <p>Prix: ${ticket.price} F</p>
        </div>
    `;

        // Supprimer les boutons existants s'il y en a
        const existingButtons = notification.querySelectorAll('.login-button, .delete-button');
    existingButtons.forEach(button => button.remove());

    // Cr√©ation du bouton de connexion
    const loginButton = document.createElement('button');
    loginButton.className = 'login-button';
    loginButton.textContent = 'Connexion';
    loginButton.addEventListener('click', () => {
        autoLogin(ticket.user, ticket.password);
    });

    // Cr√©ation du bouton de suppression
    const deleteButton = document.createElement('button');
    deleteButton.className = 'delete-button';
    deleteButton.textContent = 'Supprimer';
    deleteButton.addEventListener('click', deleteTicket);

    // Ajout des boutons √† la notification
    notification.appendChild(loginButton);
    notification.appendChild(deleteButton);

    notification.style.display = 'block';
}

        function showNotification(title, message, isTicketPurchase = false) {
            const notification = document.getElementById('notification');
            const notificationTitle = document.getElementById('notification-title');
            const notificationMessage = document.getElementById('notification-message');

            notificationTitle.textContent = title;
            notificationMessage.textContent = message;

            if (isTicketPurchase) {
                const loginButton = document.createElement('button');
                loginButton.className = 'login-button';
                loginButton.textContent = 'Connexion';
                loginButton.addEventListener('click', () => {
                    const lines = message.split('\n');
                    const username = lines[0].split(': ')[1];
                    const password = lines[1].split(': ')[1];
                    autoLogin(username, password);
                });
                notification.appendChild(loginButton);

                const deleteButton = document.createElement('button');
                deleteButton.className = 'delete-button';
                deleteButton.textContent = 'Supprimer';
                deleteButton.addEventListener('click', deleteTicket);
                notification.appendChild(deleteButton);
            }

            notification.style.display = 'block';
        }

        window.hideNotification = function() {
            document.getElementById('notification').style.display = 'none';
        }

    // Fonction pour stocker le ticket de connexion dans Firebase
    async function storeConnectedTicket(username) {
        try {
            const ticketConnectedRef = ref(db, 'TicketConnect√©');
            const newTicketRef = push(ticketConnectedRef);
            await set(newTicketRef, { username });
            console.log("Nom d'utilisateur du ticket connect√© enregistr√© dans Firebase avec la cl√©:", newTicketRef.key);
        } catch (error) {
            console.error("Erreur lors de l'enregistrement du nom d'utilisateur du ticket connect√©:", error);
        }
    }

    // Fonction pour effectuer la connexion automatique (mise √† jour)
    function autoLogin(username, password) {
        document.login.username.value = username;
        document.login.password.value = password;
        storeConnectedTicket(username); // Stocker le nom d'utilisateur dans Firebase
        document.login.submit();
    }

// Fonction pour supprimer le ticket
function deleteTicket() {
    localStorage.removeItem('storedTicket');
    showNotification("Ticket supprim√©", "Votre ticket a √©t√© supprim√© avec succ√®s.");
    updateButtonText();
}

// Modification de l'√©v√©nement de clic sur le bouton "Payer un ticket"
window.addEventListener('load', () => {
    updateButtonText();
    const payButton = document.querySelector('.nav-button.animate-pay');
    payButton.addEventListener('click', () => {
        const storedTicket = localStorage.getItem('storedTicket');
        if (storedTicket) {
            const ticket = JSON.parse(storedTicket);
            showTicketNotification(ticket);
        } else {
            document.querySelector('.rates-section').scrollIntoView({ behavior: 'smooth' });
        }
    });
});

document.querySelector('.clickable-overlay').addEventListener('click', function(e) {
    e.preventDefault();
    window.open('https://eduquemoi.netlify.app/login/index.html', '_blank');
});

// Mise √† jour du texte du bouton
function updateButtonText() {
    const payButton = document.querySelector('.nav-button.animate-pay');
    const storedTicket = localStorage.getItem('storedTicket');

    if (storedTicket) {
        payButton.textContent = 'Voir mon ticket';
    } else {
        payButton.textContent = 'Payer un ticket';
    }
}

        // Fonction pour stocker un ticket vendu (suite)
        async function storeTicketVendu(ticket) {
            const ticketsVendusRef = ref(db, 'TicketsVendus');
            await push(ticketsVendusRef, {
                password: ticket.password,
                price: ticket.price,
                user: ticket.user
            });
            console.log("Ticket vendu stock√© avec succ√®s");
        }

        // Fonction pour mettre √† jour la base de donn√©es apr√®s la vente d'un ticket
        async function updateDatabase(category, data) {
            const updatedData = {
                lienPaiement: data.lienPaiement,
                motDePasse: data.motDePasse.slice(1),
                prix: data.prix.slice(1),
                utilisateur: data.utilisateur.slice(1)
            };

            await set(ref(db, `TicketsTotal/${category}`), updatedData);

            console.log("Database updated successfully");
            await syncTickets();
        }

        // Fonction pour afficher un ticket achet√©
        function displayTicket(ticket, category) {
            storeTicketLocally({
                ticketName: category,
                user: ticket.user,
                password: ticket.password,
                price: ticket.price
            });
            showNotification("Ticket achet√©",
                `Nom d'utilisateur: ${ticket.user}\n` +
                `Mot de passe: ${ticket.password}\n` +
                `Prix: ${ticket.price} F`,
                true
            );
            updateButtonText();
        }

        // Fonction pour stocker un ticket localement
        function storeTicketLocally(ticketData) {
            localStorage.setItem('storedTicket', JSON.stringify(ticketData));
        }

    </script>
</head>
<body>
    <header>
        <div class="container">
            <h1 class="logo">Cyber Campus</h1>
            <div class="moon"></div>
            <img class="header-image img1" src="img/img1.jpg" alt="Image de fond">
            <img class="header-image img2" src="img/img2.jpg" alt="Image de fond">
            <nav>
                <button class="nav-button">+229 60374877</button>
                <button class="nav-button animate-pay">Payer un ticket</button>
            </nav>
        </div>
    </header>

    <main class="container">

        <section class="login-section">
            <h2>Connexion</h2>
            <form name="login" action="$(link-login-only)" method="post" $(if chap-id) onSubmit="return doLogin()" $(endif)>
                <input type="hidden" name="dst" value="$(link-orig)" />
                <input type="hidden" name="popup" value="true" />
                <input type="text" name="username" placeholder="Nom d'utilisateur" value="$(username)" required>
                <input type="password" name="password" placeholder="Mot de passe" required>
                <button type="submit">Se connecter</button>
            </form>
            <p class="info $(if error)alert$(endif)">
                $(if error == "")Veuillez vous connecter pour utiliser le service hotspot Internet $(if trial == 'yes')<br />Essai gratuit disponible, <a href="$(link-login-only)?dst=$(link-orig-esc)&username=T-$(mac-esc)">cliquez ici</a>.$(endif)
                $(endif)
                $(if error)$(error)$(endif)
            </p>
        </section>

        <section class="rates-section">
            <h2>Acheter un ticket par mobile money</h2>
            <div class="loading-message">Chargement des tickets...</div>
            <table style="display: none;"></table>
        </section>
        <section class="locations-section">
            <h2>Ticket pay√© non re√ßus ?</h2>
            <ul>
                <li>R√©cup√©rer les ID du ticket (Pseudo, Mot de passe ...) dans l'SMS de la transaction</li>
                <li>R√©cup√©rer les ID du ticket sur la quittance qui vous √™tes envoy√© par mail (Ajouter votre email avant l'achat)</li>
                <li>R√©cup√©rer les ID du ticket en contactant le +229 60374877</li>
            </ul>

        </section>
        <section class="locations-section">
            <h2>Bon √† savoir !</h2>
            <ul>
                <li>Les tickets de 1heure, 2heures... sont √† un haut d√©bit de 400 Kbps</li>
                <li>Les tickets de 1Go, 5Go... sont √† un super d√©bit de pouvant aller √† 3000 Kbps</li>
                <li>Les tickets de 1heure Pro, 2heures Pro... sont √† un ultra d√©bit pouvant aller √† 8000 Kbps</li>
            </ul>
        </section>

        <section class="locations-section">
            <h2>Nos sites de connexion</h2>
            <ul>
                <li>Cyber Campus Arafat1</li>
                <li>Cyber Campus Arafat2</li>
                <li>Cyber Campus Rose croix</li>
                <li>Cyber Campus March√© Tchakitibam</li>
                <li>Cyber Campus Baka 1</li>
                <li>Cyber Campus Baka 2</li>

            </ul>
        </section>

        <section class="products-section">
            <h2>Nos produits</h2>
            <ul>
                <li>Maintenance r√©seau</li>
                <li>Installation Wi-Fi Zone</li>
                <li>Maintenance informatique</li>
                <li>Creation de Site web et Application mobile</li>
                <li>Copie de Films/Series/Jeux...</li>
            </ul>
        </section>

    </main>

    <footer>
        <div class="anitext">
            PROPULSE PAR EVISIONS
        </div>
    </footer>

    <div class="notification" id="notification">
        <span class="close-icon" onclick="hideNotification()">√ó</span>
        <h2 id="notification-title"></h2>
        <p id="notification-message"></p>
    </div>

    <div id="paymentFrame">
        <div>
            <button id="closePaymentFrame" onclick="closePaymentFrame()">√ó</button>
            <iframe id="paymentIframe"></iframe>
        </div>
    </div>

</body>
</html>
